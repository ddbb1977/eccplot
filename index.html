<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Raphaël · Bouncer</title>
        <style media="screen">
            #holder {
                width: 2048px;
                height: 2048px;
            }
        </style>
        <script src="raphael.js"></script>
        <script>
            window.onload = function () {
                function Point(x, y) {
                    this.x = x;
                    this.y = y;

                    this.add = add;
                    function add(p2) {
                        var s = ((this.y - p2.y) / (this.x - p2.x)) % 17;
                        var x = (s * s - this.x - p2.x) % 17;
                        var y = (-this.y + s * (this.x - x)) % 17;
                        return Point(x, y);
                    }
                }
                var A = (new Point(2, 0)).add(new Point(1, 3));
//                window.alert(A);

                var paper = Raphael("holder", 2048, 2048),
                    btn = document.getElementById("run"),
                    cd = document.getElementById("code");
                    grid_elem = document.getElementById("grid");

                var a_elem = document.getElementById("a"),
                    b_elem = document.getElementById("b");

                (btn.onclick = function () {
                    paper.clear();
                    var p = cd.value,
                        a = a_elem.value,
						b = b_elem.value;
                    
                    var grid = grid_elem.value;
                    var xoffset = 40, yoffset = 40;
                    var gridcolor = "#AAAAAA";
                    for(var i = 0; i <= p; i++) {
                          paper.path(["M", xoffset + i * grid, yoffset, "L", xoffset + i * grid, yoffset + p * grid]).attr({stroke: gridcolor});
                          paper.path(["M", xoffset, yoffset + i * grid, "L", xoffset + p * grid, yoffset + i * grid]).attr({stroke: gridcolor});
                          paper.text(xoffset - 10, yoffset + i * grid, i);
                          paper.text(xoffset + i * grid, yoffset - 10, i);
                    }
                    for(var x = 0; x < p; x++) {
                          for(var y = 0; y < p; y++) {
                            if ((y * y) % p == (a * x * x * x + b * x) % p)
                                var circ = paper.circle(xoffset + x * grid, yoffset + y * grid, 5)
                                circ.attr("fill", "#0000FF");
                                circ.click(function() {
                                    this.attr("fill", "#FF0000");
                                });
                        }
                    }
                })();
            };

        </script>
    </head>
    <body>
        <h1>Elliptic Curves</h1>
        <div>Grid size (px):<input id="grid" type="text" value="30"></input></div>
        <div><input id="code" type="text" value="23"></input></div>
        <div>a:<input id="a" type="text" value="50"></input>b:<input id="b" type="text" value="3"></input></div>
        <div><button id="run" type="button">Run</button></div>
        <div id="holder"></div>
    </body>
</html>
